{"ast":null,"code":"import\"antd/es/upload/style/css\";import _Upload from\"antd/es/upload\";import\"antd/es/input/style/css\";import _Input from\"antd/es/input\";import\"antd/es/table/style/css\";import _Table from\"antd/es/table\";import _toConsumableArray from\"C:\\\\projects\\\\lab\\\\lab_2.0\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import\"antd/es/icon/style/css\";import _Icon from\"antd/es/icon\";import\"antd/es/message/style/css\";import _message from\"antd/es/message\";import\"antd/es/button/style/css\";import _Button from\"antd/es/button\";import _slicedToArray from\"C:\\\\projects\\\\lab\\\\lab_2.0\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import\"antd/es/modal/style/css\";import _Modal from\"antd/es/modal\";import React,{useEffect,useState}from\"react\";import BraftEditor from'braft-editor';import{connect}from\"react-redux\";import'braft-editor/dist/index.css';import*as announce from\"../../redux/actionCreators/announce\";import*as admin from\"../../redux/actionCreators/admin\";var confirm=_Modal.confirm;var Reg=/^[\\s\\S]*.*[^\\s][\\s\\S]*$/;var LabAnnounce=function LabAnnounce(props){var handleQueryAnnounce=props.handleQueryAnnounce,total=props.total,announceResource=props.announceResource,releaseAnnounceFlag=props.releaseAnnounceFlag,deleteAnnounceFlag=props.deleteAnnounceFlag,name=props.name,handleReleaseAnnounce=props.handleReleaseAnnounce,handleEditAnnounce=props.handleEditAnnounce,handleDeleteAnnounce=props.handleDeleteAnnounce;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),showBraft=_useState2[0],setShowBraft=_useState2[1];var _useState3=useState('add'),_useState4=_slicedToArray(_useState3,2),braftType=_useState4[0],setBraftType=_useState4[1];var _useState5=useState(BraftEditor.createEditorState('<p></p>')),_useState6=_slicedToArray(_useState5,2),editorState=_useState6[0],setEditorState=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),fileList=_useState8[0],setFilelist=_useState8[1];var _useState9=useState(1),_useState10=_slicedToArray(_useState9,2),presentPage=_useState10[0],setPresentPage=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),selectedId=_useState12[0],setSelectedId=_useState12[1];var _useState13=useState(true),_useState14=_slicedToArray(_useState13,2),deleteBtn=_useState14[0],setDeleteBtn=_useState14[1];var _useState15=useState(),_useState16=_slicedToArray(_useState15,2),announceTit=_useState16[0],setAnnounceTit=_useState16[1];var _useState17=useState(''),_useState18=_slicedToArray(_useState17,2),announceId=_useState18[0],setAnnounceId=_useState18[1];useEffect(function(){handleQueryAnnounce({page:presentPage,rows:10});},[deleteAnnounceFlag]);useEffect(function(){handleQueryAnnounce({page:1,rows:10});setShowBraft(false);setAnnounceTit(\"\");setEditorState(BraftEditor.createEditorState('<p></p>'));setFilelist([]);},[releaseAnnounceFlag]);var columns=[{title:'公告标题',align:'center',key:'title',dataIndex:\"title\",width:\"5rem\"},{title:'内容',key:'content',align:'center',width:'33%',render:function render(e){return/*#__PURE__*/React.createElement(\"div\",{dangerouslySetInnerHTML:{__html:e.content}});}},{title:'附件名称',key:'fileName',width:\"10%\",render:function render(e){return/*#__PURE__*/React.createElement(\"a\",{download:true,href:e.url},e.fileName);}},{title:'发布人',key:'userName',align:'center',dataIndex:\"userName\",width:\"0.75rem\"},{title:'发布时间',dataIndex:'addTime',align:'center',key:'addTime',width:\"1.5rem\"},{title:'操作',width:'1.5rem',align:'center',render:function render(e){return/*#__PURE__*/React.createElement(_Button,{type:\"primary\",onClick:function onClick(){editOrAddAnnounce('edit');setAnnounceTit(e.title);setAnnounceId(e.id);setEditorState(BraftEditor.createEditorState(e.content));}},\"\\u7F16\\u8F91\");}}];var uploadProps={beforeUpload:function beforeUpload(file){fileList.push(file);//fileList = fileList.slice(-1);\nreturn false;},onChange:function onChange(){setFilelist(fileList.slice(-1));},onRemove:function onRemove(file){var index=fileList.indexOf(file.originFileObj);fileList.splice(index,1);}};//编辑/添加公告\nvar editOrAddAnnounce=function editOrAddAnnounce(type){setShowBraft(true);setBraftType(type);if(type==='add'){setAnnounceTit('');setEditorState(BraftEditor.createEditorState('<p></p>'));}};//上传编辑或者添加\nvar addOrEdit=function addOrEdit(){var editorContent=editorState.toHTML();fileList.length>1&&_message.error(\"只能上传一个附件！\");if(Reg.test(announceTit)&&editorContent){braftType==='add'?handleReleaseAnnounce({userName:name,title:announceTit,content:editorContent,file:fileList[0]}):handleEditAnnounce({announceId:announceId,userName:name,title:announceTit,content:editorContent,file:fileList[0]});}else{_message.error(\"标题和内容不能为空！\");}};return/*#__PURE__*/React.createElement(\"div\",{style:{margin:\"1.25rem 0\"}},/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\"}},/*#__PURE__*/React.createElement(_Button,{style:{margin:\"0 0.6875rem\"},onClick:function onClick(){return editOrAddAnnounce('add');}},/*#__PURE__*/React.createElement(_Icon,{type:\"plus\"}),\"\\u6DFB\\u52A0\\u516C\\u544A\"),/*#__PURE__*/React.createElement(_Button,{disabled:deleteBtn,onClick:function onClick(){setSelectedId&&confirm({title:\"确认删除公告吗?\",onOk:function onOk(){selectedId!==undefined?handleDeleteAnnounce({announceId:selectedId}):_message.error(\"所选内容不能为空！\");setDeleteBtn(true);setSelectedId([]);},onCancel:function onCancel(){}});}},/*#__PURE__*/React.createElement(_Icon,{type:\"delete\"}),\"\\u5220\\u9664\\u516C\\u544A\")),/*#__PURE__*/React.createElement(_Table,{rowKey:function rowKey(e){return e.id;},bordered:true,columns:columns,dataSource:_toConsumableArray(announceResource),pagination:{total:total,onChange:function onChange(e){handleQueryAnnounce({page:e,rows:10});setSelectedId([]);setPresentPage(e);},hideOnSinglePage:true},rowSelection:{selectedRowKeys:selectedId,onChange:function onChange(selectedRowKeys,selectedRows){setSelectedId(selectedRowKeys);selectedRowKeys.length>0?setDeleteBtn(false):setDeleteBtn(true);}}}),/*#__PURE__*/React.createElement(_Modal,{title:braftType==='add'?\"添加公告\":'编辑公告',visible:showBraft,onCancel:function onCancel(){setShowBraft(false);setFilelist([]);},onOk:addOrEdit,width:\"50rem\",destroyOnClose:true},/*#__PURE__*/React.createElement(\"div\",{style:{display:\"flex\",alignItems:\"center\",margin:\"0.625rem 0.625rem\"}},/*#__PURE__*/React.createElement(\"h1\",null,\"\\u516C\\u544A\\u6807\\u9898\"),/*#__PURE__*/React.createElement(_Input,{style:{width:\"70%\",marginLeft:\"1.25rem\"},value:announceTit,onChange:function onChange(e){setAnnounceTit(e.target.value);}})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(BraftEditor,{value:editorState,onChange:function onChange(e){return setEditorState(e);}})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(_Upload,Object.assign({style:{marginTop:\"1.25rem\"}},uploadProps,{fileList:fileList}),/*#__PURE__*/React.createElement(_Button,{type:\"primary\"},braftType==='add'?\"添加附件\":'更改附件')))));};export default connect(function(state){return{total:state.getIn([\"announce\",\"total\"]),announceResource:state.getIn([\"announce\",\"announceResource\"]),name:state.getIn([\"userMana\",\"common\",\"name\"]),releaseAnnounceFlag:state.getIn([\"announce\",\"releaseAnnounceFlag\"]),deleteAnnounceFlag:state.getIn([\"announce\",\"deleteAnnounceFlag\"])};},function(dispatch){return{handleQueryAnnounce:function handleQueryAnnounce(page){dispatch(announce.queryAnnounce(page));},handleReleaseAnnounce:function handleReleaseAnnounce(args){dispatch(admin.releaseAnnounce(args));},handleEditAnnounce:function handleEditAnnounce(args){dispatch(admin.editAnnounce(args));},handleDeleteAnnounce:function handleDeleteAnnounce(announceId){dispatch(admin.deleteAnnounce(announceId));}};})(LabAnnounce);","map":{"version":3,"sources":["C:/projects/lab/lab_2.0/src/components/Administrator/LabAnnounce.js"],"names":["React","useEffect","useState","BraftEditor","connect","announce","admin","confirm","Reg","LabAnnounce","props","handleQueryAnnounce","total","announceResource","releaseAnnounceFlag","deleteAnnounceFlag","name","handleReleaseAnnounce","handleEditAnnounce","handleDeleteAnnounce","showBraft","setShowBraft","braftType","setBraftType","createEditorState","editorState","setEditorState","fileList","setFilelist","presentPage","setPresentPage","selectedId","setSelectedId","deleteBtn","setDeleteBtn","announceTit","setAnnounceTit","announceId","setAnnounceId","page","rows","columns","title","align","key","dataIndex","width","render","e","__html","content","url","fileName","editOrAddAnnounce","id","uploadProps","beforeUpload","file","push","onChange","slice","onRemove","index","indexOf","originFileObj","splice","type","addOrEdit","editorContent","toHTML","length","error","test","userName","margin","display","onOk","undefined","onCancel","hideOnSinglePage","selectedRowKeys","selectedRows","alignItems","marginLeft","target","value","marginTop","state","getIn","dispatch","queryAnnounce","args","releaseAnnounce","editAnnounce","deleteAnnounce"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport BraftEditor from 'braft-editor';\r\nimport {Table, Button, Icon, Modal, Upload, Input, message} from \"antd\";\r\nimport {connect} from \"react-redux\";\r\nimport 'braft-editor/dist/index.css'\r\nimport * as announce from \"../../redux/actionCreators/announce\";\r\nimport * as admin from \"../../redux/actionCreators/admin\"\r\nconst { confirm } = Modal;\r\nconst Reg = /^[\\s\\S]*.*[^\\s][\\s\\S]*$/;\r\nconst LabAnnounce = props => {\r\n    const {\r\n        handleQueryAnnounce,\r\n        total,\r\n        announceResource,\r\n        releaseAnnounceFlag,\r\n        deleteAnnounceFlag,\r\n        name,\r\n        handleReleaseAnnounce,\r\n        handleEditAnnounce,\r\n        handleDeleteAnnounce\r\n    } = props;\r\n    const [showBraft, setShowBraft] = useState(false);\r\n    const [braftType, setBraftType] = useState('add');\r\n    const [editorState, setEditorState] = useState(BraftEditor.createEditorState('<p></p>'));\r\n    const [fileList, setFilelist] = useState([]);\r\n    const [presentPage, setPresentPage] = useState(1);\r\n    const [selectedId, setSelectedId] = useState([]);\r\n    const [deleteBtn, setDeleteBtn] = useState(true);\r\n    const [announceTit, setAnnounceTit] = useState();\r\n    const [announceId, setAnnounceId] = useState('');\r\n\r\n    useEffect(() => {\r\n        handleQueryAnnounce({page: presentPage, rows: 10 })\r\n    }, [deleteAnnounceFlag]);\r\n    useEffect(() => {\r\n        handleQueryAnnounce({page: 1, rows: 10});\r\n        setShowBraft(false);\r\n        setAnnounceTit(\"\");\r\n        setEditorState(BraftEditor.createEditorState('<p></p>'));\r\n        setFilelist([]);\r\n    }, [releaseAnnounceFlag]);\r\n    const columns = [\r\n        {\r\n            title: '公告标题',\r\n            align: 'center',\r\n            key: 'title',\r\n            dataIndex: \"title\",\r\n            width: \"5rem\"\r\n        },\r\n        {\r\n            title: '内容',\r\n            key: 'content',\r\n            align: 'center',\r\n            width: '33%',\r\n            render: (e) => (\r\n                <div dangerouslySetInnerHTML={{__html: e.content}}></div>\r\n            )\r\n        },\r\n        {\r\n            title: '附件名称',\r\n            key: 'fileName',\r\n            width: \"10%\",\r\n            render: e => (\r\n                <a\r\n                    download={true}\r\n                    href={e.url}\r\n                >\r\n                    {e.fileName}\r\n                </a>\r\n            )\r\n        },\r\n        {\r\n            title: '发布人',\r\n            key: 'userName',\r\n            align: 'center',\r\n            dataIndex: \"userName\",\r\n            width: \"0.75rem\"\r\n        },\r\n        {\r\n            title: '发布时间',\r\n            dataIndex: 'addTime',\r\n            align: 'center',\r\n            key: 'addTime',\r\n            width: \"1.5rem\"\r\n        },\r\n        {\r\n            title: '操作',\r\n            width: '1.5rem',\r\n            align: 'center',\r\n            render: (e) => {\r\n                return (\r\n                    <Button\r\n                        type='primary'\r\n                        onClick={() => {\r\n                            editOrAddAnnounce('edit');\r\n                            setAnnounceTit(e.title);\r\n                            setAnnounceId(e.id);\r\n                            setEditorState(BraftEditor.createEditorState(e.content));\r\n                        }}\r\n                    >\r\n                        编辑\r\n                    </Button>\r\n                )\r\n            }\r\n        }\r\n        ];\r\n    const uploadProps = {\r\n        beforeUpload:\r\n            file => {\r\n                fileList.push(file);\r\n                //fileList = fileList.slice(-1);\r\n                return false\r\n            },\r\n        onChange:\r\n            ()=> {\r\n                setFilelist(fileList.slice(-1));\r\n            },\r\n        onRemove:\r\n            file => {\r\n                const index = fileList.indexOf(file.originFileObj);\r\n                fileList.splice(index, 1);\r\n            }\r\n    };\r\n\r\n    //编辑/添加公告\r\n    const editOrAddAnnounce = (type) => {\r\n        setShowBraft(true);\r\n        setBraftType(type);\r\n        if(type === 'add') {\r\n            setAnnounceTit('');\r\n            setEditorState(BraftEditor.createEditorState('<p></p>'));\r\n        }\r\n    }\r\n    //上传编辑或者添加\r\n    const addOrEdit = () => {\r\n        let editorContent = editorState.toHTML();\r\n        fileList.length > 1 && message.error(\"只能上传一个附件！\");\r\n        if(Reg.test(announceTit) && editorContent){\r\n            braftType === 'add' ? handleReleaseAnnounce({\r\n                userName: name,\r\n                title: announceTit,\r\n                content: editorContent,\r\n                file: fileList[0],\r\n            }) :\r\n                handleEditAnnounce({\r\n                    announceId: announceId,\r\n                    userName: name,\r\n                    title: announceTit,\r\n                    content: editorContent,\r\n                    file: fileList[0],\r\n                })\r\n        } else\r\n        {\r\n            message.error(\"标题和内容不能为空！\");\r\n        }\r\n\r\n\r\n    }\r\n\r\n    return (\r\n        <div style={{margin: \"1.25rem 0\"}}>\r\n            <div\r\n                style={{display: \"flex\"}}\r\n            >\r\n                <Button\r\n                    style={{margin: \"0 0.6875rem\"}}\r\n                    onClick={() => (editOrAddAnnounce('add'))}\r\n                >\r\n                    <Icon type={\"plus\"}/>\r\n                    添加公告\r\n                </Button>\r\n                <Button\r\n                    disabled={deleteBtn}\r\n                    onClick={() => {\r\n                        setSelectedId &&\r\n                        confirm(\r\n                            {\r\n                                title: \"确认删除公告吗?\",\r\n                                onOk() {\r\n                                    selectedId !== undefined ?\r\n                                        handleDeleteAnnounce({\r\n                                            announceId: selectedId,\r\n                                        }) :\r\n                                        message.error(\"所选内容不能为空！\");\r\n                                    setDeleteBtn(true);\r\n                                    setSelectedId([]);\r\n                                },\r\n                                onCancel() {\r\n\r\n                                }\r\n\r\n                            }\r\n                        )\r\n                    }}\r\n                >\r\n                    <Icon type={\"delete\"}/>\r\n                    删除公告\r\n                </Button>\r\n            </div>\r\n            <Table\r\n                rowKey={e => e.id}\r\n                bordered={true}\r\n                columns={columns}\r\n                dataSource={[...announceResource]}\r\n                pagination={{\r\n                    total,\r\n                    onChange: e => {\r\n                        handleQueryAnnounce({page: e, rows: 10});\r\n                        setSelectedId([]);\r\n                        setPresentPage(e);\r\n                    },\r\n                    hideOnSinglePage: true,\r\n                }}\r\n                rowSelection={{\r\n                    selectedRowKeys: selectedId,\r\n                    onChange: (selectedRowKeys, selectedRows) => {\r\n                        setSelectedId(selectedRowKeys);\r\n                        selectedRowKeys.length > 0 ? setDeleteBtn(false) : setDeleteBtn(true)\r\n\r\n                    }\r\n                }}\r\n            />\r\n            <Modal\r\n                title={braftType=== 'add' ? \"添加公告\" : '编辑公告'}\r\n                visible={showBraft}\r\n                onCancel={() => {\r\n                    setShowBraft(false);\r\n                    setFilelist([]);\r\n                }}\r\n                onOk={addOrEdit}\r\n                width={\"50rem\"}\r\n                destroyOnClose={true}\r\n            >\r\n                <div\r\n                    style={{display: \"flex\", alignItems: \"center\", margin: \"0.625rem 0.625rem\"}}\r\n                >\r\n                    <h1>公告标题</h1>\r\n                    <Input\r\n                        style={{width: \"70%\", marginLeft: \"1.25rem\"}}\r\n                        value={announceTit}\r\n                        onChange={(e) => {\r\n                            setAnnounceTit(e.target.value)\r\n                        }}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <BraftEditor\r\n                        value={editorState}\r\n                        onChange={(e) => (\r\n                            setEditorState(e)\r\n                        )}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <Upload\r\n                        style={{marginTop: \"1.25rem\"}}\r\n                        {...uploadProps} fileList={fileList} >\r\n                        <Button\r\n                            type={\"primary\"}\r\n                        >\r\n                            {\r\n                                braftType=== 'add' ? \"添加附件\" : '更改附件'\r\n                            }\r\n                        </Button>\r\n\r\n                    </Upload>\r\n                </div>\r\n            </Modal>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default connect(\r\n    state => ({\r\n        total: state.getIn([\"announce\", \"total\"]),\r\n        announceResource: state.getIn([\"announce\", \"announceResource\"]),\r\n        name: state.getIn([\"userMana\", \"common\", \"name\"]),\r\n        releaseAnnounceFlag: state.getIn([\"announce\", \"releaseAnnounceFlag\"]),\r\n        deleteAnnounceFlag: state.getIn([\"announce\", \"deleteAnnounceFlag\"]),\r\n    }),\r\n    dispatch => ({\r\n        handleQueryAnnounce(page) {\r\n            dispatch(announce.queryAnnounce(page))\r\n        },\r\n        handleReleaseAnnounce(args) {\r\n            dispatch(admin.releaseAnnounce(args))\r\n        },\r\n        handleEditAnnounce(args) {\r\n            dispatch(admin.editAnnounce(args))\r\n        },\r\n        handleDeleteAnnounce(announceId){\r\n            dispatch(admin.deleteAnnounce(announceId))\r\n        }\r\n    }),\r\n)(LabAnnounce);\r\n"]},"metadata":{},"sourceType":"module"}