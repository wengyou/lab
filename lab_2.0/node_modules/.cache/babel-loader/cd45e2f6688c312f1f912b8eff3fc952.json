{"ast":null,"code":"import \"antd/es/upload/style/css\";\nimport _Upload from \"antd/es/upload\";\nimport \"antd/es/input/style/css\";\nimport _Input from \"antd/es/input\";\nimport \"antd/es/table/style/css\";\nimport _Table from \"antd/es/table\";\nimport _toConsumableArray from \"C:\\\\projects\\\\lab\\\\lab_2.0\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";\nimport \"antd/es/icon/style/css\";\nimport _Icon from \"antd/es/icon\";\nimport \"antd/es/message/style/css\";\nimport _message from \"antd/es/message\";\nimport \"antd/es/button/style/css\";\nimport _Button from \"antd/es/button\";\nimport _slicedToArray from \"C:\\\\projects\\\\lab\\\\lab_2.0\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport \"antd/es/modal/style/css\";\nimport _Modal from \"antd/es/modal\";\n\nvar _this = this,\n    _jsxFileName = \"C:\\\\projects\\\\lab\\\\lab_2.0\\\\src\\\\components\\\\Administrator\\\\LabAnnounce.js\";\n\nimport React, { useEffect, useState } from \"react\";\nimport BraftEditor from 'braft-editor';\nimport { connect } from \"react-redux\";\nimport 'braft-editor/dist/index.css';\nimport * as announce from \"../../redux/actionCreators/announce\";\nimport * as admin from \"../../redux/actionCreators/admin\";\nvar confirm = _Modal.confirm;\nvar Reg = /^[\\s\\S]*.*[^\\s][\\s\\S]*$/;\n\nvar LabAnnounce = function LabAnnounce(props) {\n  var handleQueryAnnounce = props.handleQueryAnnounce,\n      total = props.total,\n      announceResource = props.announceResource,\n      releaseAnnounceFlag = props.releaseAnnounceFlag,\n      deleteAnnounceFlag = props.deleteAnnounceFlag,\n      name = props.name,\n      handleReleaseAnnounce = props.handleReleaseAnnounce,\n      handleEditAnnounce = props.handleEditAnnounce,\n      handleDeleteAnnounce = props.handleDeleteAnnounce;\n\n  var _useState = useState(false),\n      _useState2 = _slicedToArray(_useState, 2),\n      showBraft = _useState2[0],\n      setShowBraft = _useState2[1];\n\n  var _useState3 = useState('add'),\n      _useState4 = _slicedToArray(_useState3, 2),\n      braftType = _useState4[0],\n      setBraftType = _useState4[1];\n\n  var _useState5 = useState(BraftEditor.createEditorState('<p></p>')),\n      _useState6 = _slicedToArray(_useState5, 2),\n      editorState = _useState6[0],\n      setEditorState = _useState6[1];\n\n  var _useState7 = useState([]),\n      _useState8 = _slicedToArray(_useState7, 2),\n      fileList = _useState8[0],\n      setFilelist = _useState8[1];\n\n  var _useState9 = useState(1),\n      _useState10 = _slicedToArray(_useState9, 2),\n      presentPage = _useState10[0],\n      setPresentPage = _useState10[1];\n\n  var _useState11 = useState([]),\n      _useState12 = _slicedToArray(_useState11, 2),\n      selectedId = _useState12[0],\n      setSelectedId = _useState12[1];\n\n  var _useState13 = useState(true),\n      _useState14 = _slicedToArray(_useState13, 2),\n      deleteBtn = _useState14[0],\n      setDeleteBtn = _useState14[1];\n\n  var _useState15 = useState(),\n      _useState16 = _slicedToArray(_useState15, 2),\n      announceTit = _useState16[0],\n      setAnnounceTit = _useState16[1];\n\n  var _useState17 = useState(''),\n      _useState18 = _slicedToArray(_useState17, 2),\n      announceId = _useState18[0],\n      setAnnounceId = _useState18[1];\n\n  useEffect(function () {\n    handleQueryAnnounce({\n      page: presentPage,\n      rows: 10\n    });\n  }, [deleteAnnounceFlag]);\n  useEffect(function () {\n    handleQueryAnnounce({\n      page: 1,\n      rows: 10\n    });\n    setShowBraft(false);\n    setAnnounceTit(\"\");\n    setEditorState(BraftEditor.createEditorState('<p></p>'));\n    setFilelist([]);\n  }, [releaseAnnounceFlag]);\n  var columns = [{\n    title: '公告标题',\n    align: 'center',\n    key: 'title',\n    dataIndex: \"title\",\n    width: \"5rem\"\n  }, {\n    title: '内容',\n    key: 'content',\n    align: 'center',\n    width: '33%',\n    render: function render(e) {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        dangerouslySetInnerHTML: {\n          __html: e.content\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 56,\n          columnNumber: 17\n        }\n      });\n    }\n  }, {\n    title: '附件名称',\n    key: 'fileName',\n    width: \"10%\",\n    render: function render(e) {\n      return /*#__PURE__*/React.createElement(\"a\", {\n        download: true,\n        href: e.url,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64,\n          columnNumber: 17\n        }\n      }, e.fileName);\n    }\n  }, {\n    title: '发布人',\n    key: 'userName',\n    align: 'center',\n    dataIndex: \"userName\",\n    width: \"0.75rem\"\n  }, {\n    title: '发布时间',\n    dataIndex: 'addTime',\n    align: 'center',\n    key: 'addTime',\n    width: \"1.5rem\"\n  }, {\n    title: '操作',\n    width: '1.5rem',\n    align: 'center',\n    render: function render(e) {\n      return /*#__PURE__*/React.createElement(_Button, {\n        type: \"primary\",\n        onClick: function onClick() {\n          editOrAddAnnounce('edit');\n          setAnnounceTit(e.title);\n          setAnnounceId(e.id);\n          setEditorState(BraftEditor.createEditorState(e.content));\n        },\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 21\n        }\n      }, \"\\u7F16\\u8F91\");\n    }\n  }];\n  var uploadProps = {\n    beforeUpload: function beforeUpload(file) {\n      fileList.push(file); //fileList = fileList.slice(-1);\n\n      return false;\n    },\n    onChange: function onChange() {\n      setFilelist(fileList.slice(-1));\n    },\n    onRemove: function onRemove(file) {\n      var index = fileList.indexOf(file.originFileObj);\n      fileList.splice(index, 1);\n    }\n  }; //编辑/添加公告\n\n  var editOrAddAnnounce = function editOrAddAnnounce(type) {\n    setShowBraft(true);\n    setBraftType(type);\n\n    if (type === 'add') {\n      setAnnounceTit('');\n      setEditorState(BraftEditor.createEditorState('<p></p>'));\n    }\n  }; //上传编辑或者添加\n\n\n  var addOrEdit = function addOrEdit() {\n    var editorContent = editorState.toHTML();\n    fileList.length > 1 && _message.error(\"只能上传一个附件！\");\n\n    if (Reg.test(announceTit) && editorContent) {\n      braftType === 'add' ? handleReleaseAnnounce({\n        userName: name,\n        title: announceTit,\n        content: editorContent,\n        file: fileList[0]\n      }) : handleEditAnnounce({\n        announceId: announceId,\n        userName: name,\n        title: announceTit,\n        content: editorContent,\n        file: fileList[0]\n      });\n    } else {\n      _message.error(\"标题和内容不能为空！\");\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      margin: \"1.25rem 0\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 161,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: \"flex\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(_Button, {\n    style: {\n      margin: \"0 0.6875rem\"\n    },\n    onClick: function onClick() {\n      return editOrAddAnnounce('add');\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Icon, {\n    type: \"plus\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 21\n    }\n  }), \"\\u6DFB\\u52A0\\u516C\\u544A\"), /*#__PURE__*/React.createElement(_Button, {\n    disabled: deleteBtn,\n    onClick: function onClick() {\n      setSelectedId && confirm({\n        title: \"确认删除公告吗?\",\n        onOk: function onOk() {\n          selectedId !== undefined ? handleDeleteAnnounce({\n            announceId: selectedId\n          }) : _message.error(\"所选内容不能为空！\");\n          setDeleteBtn(true);\n          setSelectedId([]);\n        },\n        onCancel: function onCancel() {}\n      });\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Icon, {\n    type: \"delete\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 196,\n      columnNumber: 21\n    }\n  }), \"\\u5220\\u9664\\u516C\\u544A\")), /*#__PURE__*/React.createElement(_Table, {\n    rowKey: function rowKey(e) {\n      return e.id;\n    },\n    bordered: true,\n    columns: columns,\n    dataSource: _toConsumableArray(announceResource),\n    pagination: {\n      total: total,\n      onChange: function onChange(e) {\n        handleQueryAnnounce({\n          page: e,\n          rows: 10\n        });\n        setSelectedId([]);\n        setPresentPage(e);\n      },\n      hideOnSinglePage: true\n    },\n    rowSelection: {\n      selectedRowKeys: selectedId,\n      onChange: function onChange(selectedRowKeys, selectedRows) {\n        setSelectedId(selectedRowKeys);\n        selectedRowKeys.length > 0 ? setDeleteBtn(false) : setDeleteBtn(true);\n      }\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(_Modal, {\n    title: braftType === 'add' ? \"添加公告\" : '编辑公告',\n    visible: showBraft,\n    onCancel: function onCancel() {\n      setShowBraft(false);\n      setFilelist([]);\n    },\n    onOk: addOrEdit,\n    width: \"50rem\",\n    destroyOnClose: true,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: \"flex\",\n      alignItems: \"center\",\n      margin: \"0.625rem 0.625rem\"\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 21\n    }\n  }, \"\\u516C\\u544A\\u6807\\u9898\"), /*#__PURE__*/React.createElement(_Input, {\n    style: {\n      width: \"70%\",\n      marginLeft: \"1.25rem\"\n    },\n    value: announceTit,\n    onChange: function onChange(e) {\n      setAnnounceTit(e.target.value);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(BraftEditor, {\n    value: editorState,\n    onChange: function onChange(e) {\n      return setEditorState(e);\n    },\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 21\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(_Upload, Object.assign({\n    style: {\n      marginTop: \"1.25rem\"\n    }\n  }, uploadProps, {\n    fileList: fileList,\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 255,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(_Button, {\n    type: \"primary\",\n    __self: _this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 25\n    }\n  }, braftType === 'add' ? \"添加附件\" : '更改附件')))));\n};\n\nexport default connect(function (state) {\n  return {\n    total: state.getIn([\"announce\", \"total\"]),\n    announceResource: state.getIn([\"announce\", \"announceResource\"]),\n    name: state.getIn([\"userMana\", \"common\", \"name\"]),\n    releaseAnnounceFlag: state.getIn([\"announce\", \"releaseAnnounceFlag\"]),\n    deleteAnnounceFlag: state.getIn([\"announce\", \"deleteAnnounceFlag\"])\n  };\n}, function (dispatch) {\n  return {\n    handleQueryAnnounce: function handleQueryAnnounce(page) {\n      dispatch(announce.queryAnnounce(page));\n    },\n    handleReleaseAnnounce: function handleReleaseAnnounce(args) {\n      dispatch(admin.releaseAnnounce(args));\n    },\n    handleEditAnnounce: function handleEditAnnounce(args) {\n      dispatch(admin.editAnnounce(args));\n    },\n    handleDeleteAnnounce: function handleDeleteAnnounce(announceId) {\n      dispatch(admin.deleteAnnounce(announceId));\n    }\n  };\n})(LabAnnounce);","map":{"version":3,"sources":["C:/projects/lab/lab_2.0/src/components/Administrator/LabAnnounce.js"],"names":["React","useEffect","useState","BraftEditor","connect","announce","admin","confirm","Reg","LabAnnounce","props","handleQueryAnnounce","total","announceResource","releaseAnnounceFlag","deleteAnnounceFlag","name","handleReleaseAnnounce","handleEditAnnounce","handleDeleteAnnounce","showBraft","setShowBraft","braftType","setBraftType","createEditorState","editorState","setEditorState","fileList","setFilelist","presentPage","setPresentPage","selectedId","setSelectedId","deleteBtn","setDeleteBtn","announceTit","setAnnounceTit","announceId","setAnnounceId","page","rows","columns","title","align","key","dataIndex","width","render","e","__html","content","url","fileName","editOrAddAnnounce","id","uploadProps","beforeUpload","file","push","onChange","slice","onRemove","index","indexOf","originFileObj","splice","type","addOrEdit","editorContent","toHTML","length","error","test","userName","margin","display","onOk","undefined","onCancel","hideOnSinglePage","selectedRowKeys","selectedRows","alignItems","marginLeft","target","value","marginTop","state","getIn","dispatch","queryAnnounce","args","releaseAnnounce","editAnnounce","deleteAnnounce"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport BraftEditor from 'braft-editor';\r\nimport {Table, Button, Icon, Modal, Upload, Input, message} from \"antd\";\r\nimport {connect} from \"react-redux\";\r\nimport 'braft-editor/dist/index.css'\r\nimport * as announce from \"../../redux/actionCreators/announce\";\r\nimport * as admin from \"../../redux/actionCreators/admin\"\r\nconst { confirm } = Modal;\r\nconst Reg = /^[\\s\\S]*.*[^\\s][\\s\\S]*$/;\r\nconst LabAnnounce = props => {\r\n    const {\r\n        handleQueryAnnounce,\r\n        total,\r\n        announceResource,\r\n        releaseAnnounceFlag,\r\n        deleteAnnounceFlag,\r\n        name,\r\n        handleReleaseAnnounce,\r\n        handleEditAnnounce,\r\n        handleDeleteAnnounce\r\n    } = props;\r\n    const [showBraft, setShowBraft] = useState(false);\r\n    const [braftType, setBraftType] = useState('add');\r\n    const [editorState, setEditorState] = useState(BraftEditor.createEditorState('<p></p>'));\r\n    const [fileList, setFilelist] = useState([]);\r\n    const [presentPage, setPresentPage] = useState(1);\r\n    const [selectedId, setSelectedId] = useState([]);\r\n    const [deleteBtn, setDeleteBtn] = useState(true);\r\n    const [announceTit, setAnnounceTit] = useState();\r\n    const [announceId, setAnnounceId] = useState('');\r\n\r\n    useEffect(() => {\r\n        handleQueryAnnounce({page: presentPage, rows: 10 })\r\n    }, [deleteAnnounceFlag]);\r\n    useEffect(() => {\r\n        handleQueryAnnounce({page: 1, rows: 10});\r\n        setShowBraft(false);\r\n        setAnnounceTit(\"\");\r\n        setEditorState(BraftEditor.createEditorState('<p></p>'));\r\n        setFilelist([]);\r\n    }, [releaseAnnounceFlag]);\r\n    const columns = [\r\n        {\r\n            title: '公告标题',\r\n            align: 'center',\r\n            key: 'title',\r\n            dataIndex: \"title\",\r\n            width: \"5rem\"\r\n        },\r\n        {\r\n            title: '内容',\r\n            key: 'content',\r\n            align: 'center',\r\n            width: '33%',\r\n            render: (e) => (\r\n                <div dangerouslySetInnerHTML={{__html: e.content}}></div>\r\n            )\r\n        },\r\n        {\r\n            title: '附件名称',\r\n            key: 'fileName',\r\n            width: \"10%\",\r\n            render: e => (\r\n                <a\r\n                    download={true}\r\n                    href={e.url}\r\n                >\r\n                    {e.fileName}\r\n                </a>\r\n            )\r\n        },\r\n        {\r\n            title: '发布人',\r\n            key: 'userName',\r\n            align: 'center',\r\n            dataIndex: \"userName\",\r\n            width: \"0.75rem\"\r\n        },\r\n        {\r\n            title: '发布时间',\r\n            dataIndex: 'addTime',\r\n            align: 'center',\r\n            key: 'addTime',\r\n            width: \"1.5rem\"\r\n        },\r\n        {\r\n            title: '操作',\r\n            width: '1.5rem',\r\n            align: 'center',\r\n            render: (e) => {\r\n                return (\r\n                    <Button\r\n                        type='primary'\r\n                        onClick={() => {\r\n                            editOrAddAnnounce('edit');\r\n                            setAnnounceTit(e.title);\r\n                            setAnnounceId(e.id);\r\n                            setEditorState(BraftEditor.createEditorState(e.content));\r\n                        }}\r\n                    >\r\n                        编辑\r\n                    </Button>\r\n                )\r\n            }\r\n        }\r\n        ];\r\n    const uploadProps = {\r\n        beforeUpload:\r\n            file => {\r\n                fileList.push(file);\r\n                //fileList = fileList.slice(-1);\r\n                return false\r\n            },\r\n        onChange:\r\n            ()=> {\r\n                setFilelist(fileList.slice(-1));\r\n            },\r\n        onRemove:\r\n            file => {\r\n                const index = fileList.indexOf(file.originFileObj);\r\n                fileList.splice(index, 1);\r\n            }\r\n    };\r\n\r\n    //编辑/添加公告\r\n    const editOrAddAnnounce = (type) => {\r\n        setShowBraft(true);\r\n        setBraftType(type);\r\n        if(type === 'add') {\r\n            setAnnounceTit('');\r\n            setEditorState(BraftEditor.createEditorState('<p></p>'));\r\n        }\r\n    }\r\n    //上传编辑或者添加\r\n    const addOrEdit = () => {\r\n        let editorContent = editorState.toHTML();\r\n        fileList.length > 1 && message.error(\"只能上传一个附件！\");\r\n        if(Reg.test(announceTit) && editorContent){\r\n            braftType === 'add' ? handleReleaseAnnounce({\r\n                userName: name,\r\n                title: announceTit,\r\n                content: editorContent,\r\n                file: fileList[0],\r\n            }) :\r\n                handleEditAnnounce({\r\n                    announceId: announceId,\r\n                    userName: name,\r\n                    title: announceTit,\r\n                    content: editorContent,\r\n                    file: fileList[0],\r\n                })\r\n        } else\r\n        {\r\n            message.error(\"标题和内容不能为空！\");\r\n        }\r\n\r\n\r\n    }\r\n\r\n    return (\r\n        <div style={{margin: \"1.25rem 0\"}}>\r\n            <div\r\n                style={{display: \"flex\"}}\r\n            >\r\n                <Button\r\n                    style={{margin: \"0 0.6875rem\"}}\r\n                    onClick={() => (editOrAddAnnounce('add'))}\r\n                >\r\n                    <Icon type={\"plus\"}/>\r\n                    添加公告\r\n                </Button>\r\n                <Button\r\n                    disabled={deleteBtn}\r\n                    onClick={() => {\r\n                        setSelectedId &&\r\n                        confirm(\r\n                            {\r\n                                title: \"确认删除公告吗?\",\r\n                                onOk() {\r\n                                    selectedId !== undefined ?\r\n                                        handleDeleteAnnounce({\r\n                                            announceId: selectedId,\r\n                                        }) :\r\n                                        message.error(\"所选内容不能为空！\");\r\n                                    setDeleteBtn(true);\r\n                                    setSelectedId([]);\r\n                                },\r\n                                onCancel() {\r\n\r\n                                }\r\n\r\n                            }\r\n                        )\r\n                    }}\r\n                >\r\n                    <Icon type={\"delete\"}/>\r\n                    删除公告\r\n                </Button>\r\n            </div>\r\n            <Table\r\n                rowKey={e => e.id}\r\n                bordered={true}\r\n                columns={columns}\r\n                dataSource={[...announceResource]}\r\n                pagination={{\r\n                    total,\r\n                    onChange: e => {\r\n                        handleQueryAnnounce({page: e, rows: 10});\r\n                        setSelectedId([]);\r\n                        setPresentPage(e);\r\n                    },\r\n                    hideOnSinglePage: true,\r\n                }}\r\n                rowSelection={{\r\n                    selectedRowKeys: selectedId,\r\n                    onChange: (selectedRowKeys, selectedRows) => {\r\n                        setSelectedId(selectedRowKeys);\r\n                        selectedRowKeys.length > 0 ? setDeleteBtn(false) : setDeleteBtn(true)\r\n\r\n                    }\r\n                }}\r\n            />\r\n            <Modal\r\n                title={braftType=== 'add' ? \"添加公告\" : '编辑公告'}\r\n                visible={showBraft}\r\n                onCancel={() => {\r\n                    setShowBraft(false);\r\n                    setFilelist([]);\r\n                }}\r\n                onOk={addOrEdit}\r\n                width={\"50rem\"}\r\n                destroyOnClose={true}\r\n            >\r\n                <div\r\n                    style={{display: \"flex\", alignItems: \"center\", margin: \"0.625rem 0.625rem\"}}\r\n                >\r\n                    <h1>公告标题</h1>\r\n                    <Input\r\n                        style={{width: \"70%\", marginLeft: \"1.25rem\"}}\r\n                        value={announceTit}\r\n                        onChange={(e) => {\r\n                            setAnnounceTit(e.target.value)\r\n                        }}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <BraftEditor\r\n                        value={editorState}\r\n                        onChange={(e) => (\r\n                            setEditorState(e)\r\n                        )}\r\n                    />\r\n                </div>\r\n                <div>\r\n                    <Upload\r\n                        style={{marginTop: \"1.25rem\"}}\r\n                        {...uploadProps} fileList={fileList} >\r\n                        <Button\r\n                            type={\"primary\"}\r\n                        >\r\n                            {\r\n                                braftType=== 'add' ? \"添加附件\" : '更改附件'\r\n                            }\r\n                        </Button>\r\n\r\n                    </Upload>\r\n                </div>\r\n            </Modal>\r\n        </div>\r\n    )\r\n};\r\n\r\nexport default connect(\r\n    state => ({\r\n        total: state.getIn([\"announce\", \"total\"]),\r\n        announceResource: state.getIn([\"announce\", \"announceResource\"]),\r\n        name: state.getIn([\"userMana\", \"common\", \"name\"]),\r\n        releaseAnnounceFlag: state.getIn([\"announce\", \"releaseAnnounceFlag\"]),\r\n        deleteAnnounceFlag: state.getIn([\"announce\", \"deleteAnnounceFlag\"]),\r\n    }),\r\n    dispatch => ({\r\n        handleQueryAnnounce(page) {\r\n            dispatch(announce.queryAnnounce(page))\r\n        },\r\n        handleReleaseAnnounce(args) {\r\n            dispatch(admin.releaseAnnounce(args))\r\n        },\r\n        handleEditAnnounce(args) {\r\n            dispatch(admin.editAnnounce(args))\r\n        },\r\n        handleDeleteAnnounce(announceId){\r\n            dispatch(admin.deleteAnnounce(announceId))\r\n        }\r\n    }),\r\n)(LabAnnounce);\r\n"]},"metadata":{},"sourceType":"module"}